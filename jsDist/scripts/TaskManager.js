"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _lodash = _interopRequireDefault(require("lodash"));

var _onChange = _interopRequireDefault(require("on-change"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && Symbol.iterator in Object(iter)) return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

var getElementsIn = function getElementsIn(state, type) {
  var isDone = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

  switch (type) {
    case 'list':
      {
        return state.lists;
      }

    case 'task':
      {
        return _lodash["default"].concat(state.tasks).filter(function (task) {
          return task.parentList === state.activeList.name && task.isDone === isDone;
        });
      }

    default:
      {
        throw Error("Unknown type in function - \"getElementsIn\": ".concat(type));
      }
  }
};

var getElementById = function getElementById(state, id) {
  var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'task';
  return [].concat(_toConsumableArray(getElementsIn(state, type)), _toConsumableArray(getElementsIn(state, type, true))).find(function (task) {
    return task.id === id;
  });
};

var sortByPosition = function sortByPosition(array) {
  return _lodash["default"].concat(array).sort(function (a, b) {
    return a.position - b.position;
  });
};

var sortPositionsAfterRemove = function sortPositionsAfterRemove(state, type, isDone) {
  var sortGroup = getElementsIn(state, type, isDone);
  sortByPosition(sortGroup).reduce(function (accIndex, el) {
    el.position = accIndex;
    return accIndex + 1;
  }, 0);
};

var getPosition = function getPosition(state, type) {
  var isDone = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
  return getElementsIn(state, type, isDone).length;
};

var getSelectedElementId = function getSelectedElementId(state) {
  if (state.activeTaskId !== null) return state.activeTaskId;
  var nextElement = sortByPosition(getElementsIn(state, 'task'))[0];
  return nextElement ? nextElement.id : null;
};

var eventFunctions = {
  lists: {
    select: function select(state, button) {
      var _button$dataset = button.dataset,
          id = _button$dataset.id,
          name = _button$dataset.name;
      state.activeList = {
        id: id,
        name: name
      };
    }
  },
  buttons: {
    replace: function replace(state, button) {
      var replaceType = button.dataset.buttonFunc;
      var taskContainer = button.parentNode.parentNode;
      var _taskContainer$datase = taskContainer.dataset,
          type = _taskContainer$datase.type,
          id = _taskContainer$datase.id;
      var upDownPos = replaceType === 'up' ? -1 : 1;
      var mainElement = getElementById(state, id, type);
      var secondaryElement = getElementsIn(state, type).find(function (task) {
        return task.position === mainElement.position + upDownPos;
      });
      if (!secondaryElement) return;
      mainElement.position += upDownPos;
      secondaryElement.position -= upDownPos;
    },
    startOutOfTurn: function startOutOfTurn(state, button) {
      var taskContainer = button.parentNode.parentNode;
      var id = taskContainer.dataset.id;
      state.activeTaskId = id;
      state.mainState.setValues(id);
    },
    doneUndone: function doneUndone(state, button) {
      var taskContainer = button.parentNode.parentNode;
      var id = taskContainer.dataset.id;
      var task = getElementById(state, id);
      task.isDone = !task.isDone;

      if (task.isDone && getSelectedElementId(state) === id) {
        state.mainState.isDone = !state.mainState.isDone;
      }

      task.position = getPosition(state, 'task', task.isDone);
      sortPositionsAfterRemove(state, 'task', false);
      sortPositionsAfterRemove(state, 'task', true);
    },
    remove: function remove(state, button) {
      var taskContainer = button.parentNode.parentNode;
      var _taskContainer$datase2 = taskContainer.dataset,
          type = _taskContainer$datase2.type,
          id = _taskContainer$datase2.id;
      var typeArea = "".concat(type === 'list' ? 'lists' : 'tasks');
      state[typeArea] = state[typeArea].filter(function (el) {
        return el.id !== id;
      });
      var isDone = type === 'doneTask';
      sortPositionsAfterRemove(state, 'task', isDone);
    }
  }
};
var selectButtons = {
  list: function list(isMutable) {
    return isMutable ? ['up', 'down', 'remove'] : ['up', 'down'];
  },
  task: function task(isActive) {
    return isActive ? ['up', 'down', 'done', 'remove'] : ['up', 'down', 'startOutOfTurn', 'done', 'remove'];
  },
  doneTask: function doneTask() {
    return ['undone', 'remove'];
  }
};

var putButtons = function putButtons(state, elementType, _ref) {
  var buttons = _ref.buttons;
  var option = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;
  return buttons.filter(function (_ref2) {
    var type = _ref2.type;
    return selectButtons[elementType](option).includes(type);
  }).map(function (_ref3) {
    var button = _ref3.button;
    return button.cloneNode(true);
  }).map(function (button) {
    button.addEventListener('click', function (e) {
      e.preventDefault();
      eventFunctions.buttons[button.dataset.buttonType](state, e.target);
    });
    return button;
  });
};

var resetInputs = function resetInputs(elements) {
  elements.listForm.reset();
  elements.taskForm.reset();
};

var renderLists = function renderLists(state, elements) {
  var ulForLists = document.createElement('ul');
  sortByPosition(getElementsIn(state, 'list')).forEach(function (_ref4) {
    var id = _ref4.id,
        name = _ref4.name,
        isMutable = _ref4.isMutable;
    var li = document.createElement('li');
    li.dataset.type = 'list';
    li.dataset.id = id;
    li.dataset.name = name;
    var text = document.createElement('p');
    text.textContent = name;
    li.addEventListener('click', function (_ref5) {
      var target = _ref5.target,
          currentTarget = _ref5.currentTarget;
      if (currentTarget === target || text === target) eventFunctions.lists.select(state, li);
    });
    var allButtons = putButtons(state, 'list', elements, isMutable);
    var replaceButt = document.createElement('div');
    replaceButt.classList.add('replaceContainer');
    replaceButt.append.apply(replaceButt, _toConsumableArray(allButtons.filter(function (b) {
      return b.dataset.buttonType === 'replace';
    })));

    if (id === state.activeList.id) {
      li.classList.add('active');
      li.append(replaceButt, text);
    } else if (!isMutable) {
      li.append(replaceButt, text);
    } else {
      var removeButt = document.createElement('div');
      removeButt.classList.add('removeContainer');
      removeButt.appendChild(allButtons.find(function (b) {
        return b.dataset.buttonType === 'remove';
      }));
      li.append(replaceButt, text, removeButt);
    }

    ulForLists.appendChild(li);
  });
  elements.lists.innerHTML = '';
  elements.lists.appendChild(ulForLists);
  resetInputs(elements);
};

var renderTasks = function renderTasks(state, elements) {
  var ulForTasks = document.createElement('ul');
  sortByPosition(getElementsIn(state, 'task', false)).forEach(function (_ref6) {
    var id = _ref6.id,
        name = _ref6.name;
    var li = document.createElement('li');
    li.dataset.id = id;
    li.dataset.type = 'task';
    var isActive = id === getSelectedElementId(state);

    if (isActive) {
      li.classList.add('active');
    }

    var text = document.createElement('p');
    text.textContent = name;
    var allButtons = putButtons(state, 'task', elements, isActive);
    var replaceButt = document.createElement('div');
    replaceButt.classList.add('replaceContainer');
    replaceButt.append.apply(replaceButt, _toConsumableArray(allButtons.filter(function (b) {
      return b.dataset.buttonType === 'replace';
    })));
    var removeButt = document.createElement('div');
    removeButt.classList.add('removeContainer');
    removeButt.appendChild(allButtons.find(function (b) {
      return b.dataset.buttonType === 'remove';
    }));
    var otherButt = document.createElement('div');
    otherButt.classList.add('otherContainer');
    otherButt.append.apply(otherButt, _toConsumableArray(allButtons.filter(function (b) {
      return b.dataset.buttonType !== 'replace' && b.dataset.buttonType !== 'remove';
    })));
    li.append(replaceButt, text, otherButt, removeButt);
    ulForTasks.appendChild(li);
  });
  elements.tasks.innerHTML = '';

  if (ulForTasks.innerHTML !== '') {
    elements.tasks.appendChild(ulForTasks);
  } else {
    elements.tasks.appendChild(elements.taskPrompt);
  }

  var ulForDoneTasks = document.createElement('ul');
  sortByPosition(getElementsIn(state, 'task', true)).forEach(function (_ref7) {
    var id = _ref7.id,
        name = _ref7.name;
    var li = document.createElement('li');
    li.dataset.id = id;
    li.dataset.type = 'doneTask';
    var text = document.createElement('p');
    text.textContent = name;
    var allButtons = putButtons(state, 'doneTask', elements);
    var removeButt = document.createElement('div');
    removeButt.classList.add('removeContainer');
    removeButt.appendChild(allButtons.find(function (b) {
      return b.dataset.buttonType === 'remove';
    }));
    var undoneButt = document.createElement('div');
    undoneButt.classList.add('undoneContainer');
    undoneButt.appendChild(allButtons.find(function (b) {
      return b.dataset.buttonType === 'doneUndone';
    }));
    li.append(undoneButt, text, removeButt);
    ulForDoneTasks.appendChild(li);
  });
  elements.doneTasks.innerHTML = '';

  if (ulForDoneTasks.innerHTML !== '') {
    elements.doneTasks.appendChild(ulForDoneTasks);
  } else {
    elements.doneTasks.appendChild(elements.doneTaskPrompt);
  }

  resetInputs(elements);
};

var render = {
  lists: renderLists,
  tasks: renderTasks,
  all: function all(state, elements) {
    renderLists(state, elements);
    renderTasks(state, elements);
  }
};

var createButtonsModels = function createButtonsModels() {
  var upButton = document.createElement('button');
  upButton.classList.add('up');
  upButton.dataset.buttonType = 'replace';
  upButton.dataset.buttonFunc = 'up';
  var downButton = document.createElement('button');
  downButton.classList.add('down');
  downButton.dataset.buttonType = 'replace';
  downButton.dataset.buttonFunc = 'down';
  var startOutOfTurnButton = document.createElement('button');
  startOutOfTurnButton.classList.add('startOutOfTurn');
  startOutOfTurnButton.dataset.buttonType = 'startOutOfTurn';
  var doneButton = document.createElement('button');
  doneButton.classList.add('done');
  doneButton.dataset.buttonType = 'doneUndone';
  var undoneButton = document.createElement('button');
  undoneButton.classList.add('undone');
  undoneButton.dataset.buttonType = 'doneUndone';
  var removeButton = document.createElement('button');
  removeButton.classList.add('remove');
  removeButton.dataset.buttonType = 'remove';
  return [{
    type: 'up',
    button: upButton
  }, {
    type: 'down',
    button: downButton
  }, {
    type: 'startOutOfTurn',
    button: startOutOfTurnButton
  }, {
    type: 'done',
    button: doneButton
  }, {
    type: 'undone',
    button: undoneButton
  }, {
    type: 'remove',
    button: removeButton
  }];
};

var elements = {
  lists: document.querySelector('[data-container="lists"]'),
  listForm: document.querySelector('[data-container="new-list-form"]'),
  tasks: document.querySelector('[data-container="tasks"]'),
  taskPrompt: document.querySelector('[data-container="tasks-prompt"]'),
  taskForm: document.querySelector('[data-container="new-task-form"]'),
  doneTasks: document.querySelector('[data-container="done-tasks"]'),
  doneTaskPrompt: document.querySelector('[data-container="done-tasks-prompt"]'),
  selectedTask: document.querySelector('[data-container="selected-task"]'),
  buttons: createButtonsModels()
};
var state = (0, _onChange["default"])({
  activeList: {
    id: null,
    name: ''
  },
  activeTaskId: null,
  lists: [],
  tasks: []
}, function (path) {
  path === 'activeList' ? render.all(this, elements) : null;
  path === 'activeTaskId' ? render.tasks(this, elements) : null;
  path.includes('lists') ? render.lists(this, elements) : null;
  path.includes('tasks') ? render.tasks(this, elements) : null;
});

var init = function init(mainState) {
  state.mainState = mainState;
  elements.listForm.addEventListener('submit', function (e) {
    e.preventDefault();
    var formData = new FormData(e.target);
    var value = formData.get('name');

    if (value !== '') {
      state.lists.push({
        id: _lodash["default"].uniqueId(),
        name: value,
        position: getPosition(state, 'list'),
        isMutable: true
      });
    }
  });
  elements.taskForm.addEventListener('submit', function (e) {
    e.preventDefault();
    var formData = new FormData(e.target);
    var value = formData.get('name');

    if (value !== '') {
      var task = {
        id: _lodash["default"].uniqueId(),
        parentList: state.activeList.name,
        name: value,
        position: getPosition(state, 'task'),
        isDone: false
      };
      state.tasks.push(task);
    }
  });
  var generalList = {
    id: _lodash["default"].uniqueId(),
    name: 'General',
    position: getPosition(state, 'list'),
    isMutable: false
  };
  state.activeList = {
    id: generalList.id,
    name: generalList.name
  };
  state.lists.push(generalList);
};

var completeTask = function completeTask() {
  var id = getSelectedElementId(state);
  if (id === null) return;
  var task = getElementById(state, id);
  task.isDone = true;
  state.activeTaskId = null;
};

var TaskManager = {
  init: init,
  completeTask: completeTask
};
var _default = TaskManager;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2pzU3JjL3NjcmlwdHMvVGFza01hbmFnZXIuanMiXSwibmFtZXMiOlsiZ2V0RWxlbWVudHNJbiIsInN0YXRlIiwidHlwZSIsImlzRG9uZSIsImxpc3RzIiwiXyIsImNvbmNhdCIsInRhc2tzIiwiZmlsdGVyIiwidGFzayIsInBhcmVudExpc3QiLCJhY3RpdmVMaXN0IiwibmFtZSIsIkVycm9yIiwiZ2V0RWxlbWVudEJ5SWQiLCJpZCIsImZpbmQiLCJzb3J0QnlQb3NpdGlvbiIsImFycmF5Iiwic29ydCIsImEiLCJiIiwicG9zaXRpb24iLCJzb3J0UG9zaXRpb25zQWZ0ZXJSZW1vdmUiLCJzb3J0R3JvdXAiLCJyZWR1Y2UiLCJhY2NJbmRleCIsImVsIiwiZ2V0UG9zaXRpb24iLCJsZW5ndGgiLCJnZXRTZWxlY3RlZEVsZW1lbnRJZCIsImFjdGl2ZVRhc2tJZCIsIm5leHRFbGVtZW50IiwiZXZlbnRGdW5jdGlvbnMiLCJzZWxlY3QiLCJidXR0b24iLCJkYXRhc2V0IiwiYnV0dG9ucyIsInJlcGxhY2UiLCJyZXBsYWNlVHlwZSIsImJ1dHRvbkZ1bmMiLCJ0YXNrQ29udGFpbmVyIiwicGFyZW50Tm9kZSIsInVwRG93blBvcyIsIm1haW5FbGVtZW50Iiwic2Vjb25kYXJ5RWxlbWVudCIsInN0YXJ0T3V0T2ZUdXJuIiwibWFpblN0YXRlIiwic2V0VmFsdWVzIiwiZG9uZVVuZG9uZSIsInJlbW92ZSIsInR5cGVBcmVhIiwic2VsZWN0QnV0dG9ucyIsImxpc3QiLCJpc011dGFibGUiLCJpc0FjdGl2ZSIsImRvbmVUYXNrIiwicHV0QnV0dG9ucyIsImVsZW1lbnRUeXBlIiwib3B0aW9uIiwiaW5jbHVkZXMiLCJtYXAiLCJjbG9uZU5vZGUiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInByZXZlbnREZWZhdWx0IiwiYnV0dG9uVHlwZSIsInRhcmdldCIsInJlc2V0SW5wdXRzIiwiZWxlbWVudHMiLCJsaXN0Rm9ybSIsInJlc2V0IiwidGFza0Zvcm0iLCJyZW5kZXJMaXN0cyIsInVsRm9yTGlzdHMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJmb3JFYWNoIiwibGkiLCJ0ZXh0IiwidGV4dENvbnRlbnQiLCJjdXJyZW50VGFyZ2V0IiwiYWxsQnV0dG9ucyIsInJlcGxhY2VCdXR0IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kIiwicmVtb3ZlQnV0dCIsImFwcGVuZENoaWxkIiwiaW5uZXJIVE1MIiwicmVuZGVyVGFza3MiLCJ1bEZvclRhc2tzIiwib3RoZXJCdXR0IiwidGFza1Byb21wdCIsInVsRm9yRG9uZVRhc2tzIiwidW5kb25lQnV0dCIsImRvbmVUYXNrcyIsImRvbmVUYXNrUHJvbXB0IiwicmVuZGVyIiwiYWxsIiwiY3JlYXRlQnV0dG9uc01vZGVscyIsInVwQnV0dG9uIiwiZG93bkJ1dHRvbiIsInN0YXJ0T3V0T2ZUdXJuQnV0dG9uIiwiZG9uZUJ1dHRvbiIsInVuZG9uZUJ1dHRvbiIsInJlbW92ZUJ1dHRvbiIsInF1ZXJ5U2VsZWN0b3IiLCJzZWxlY3RlZFRhc2siLCJwYXRoIiwiaW5pdCIsImZvcm1EYXRhIiwiRm9ybURhdGEiLCJ2YWx1ZSIsImdldCIsInB1c2giLCJ1bmlxdWVJZCIsImdlbmVyYWxMaXN0IiwiY29tcGxldGVUYXNrIiwiVGFza01hbmFnZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFJQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLGFBQWEsR0FBRyxTQUFoQkEsYUFBZ0IsQ0FBQ0MsS0FBRCxFQUFRQyxJQUFSLEVBQWlDO0FBQUEsTUFBbkJDLE1BQW1CLHVFQUFWLEtBQVU7O0FBQ3JELFVBQVFELElBQVI7QUFDRSxTQUFLLE1BQUw7QUFBYTtBQUNYLGVBQU9ELEtBQUssQ0FBQ0csS0FBYjtBQUNEOztBQUNELFNBQUssTUFBTDtBQUFhO0FBQ1gsZUFBT0MsbUJBQUVDLE1BQUYsQ0FBU0wsS0FBSyxDQUFDTSxLQUFmLEVBQ0pDLE1BREksQ0FDRyxVQUFDQyxJQUFEO0FBQUEsaUJBQVdBLElBQUksQ0FBQ0MsVUFB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QUFkO0FBQ0FGLEVBQUFBLEtBQUssQ0FBQzhCLFlBQU4sR0FBcUIsSUFBckI7QUFDRCxDQU5EOztBQVFBLElBQU13RixXQUFXLEdBQUc7QUFDbEJULEVBQUFBLElBQUksRUFBSkEsSUFEa0I7QUFFbEJRLEVBQUFBLFlBQVksRUFBWkE7QUFGa0IsQ0FBcEI7ZUFLZUMsVyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9uby1leHRyYW5lb3VzLWRlcGVuZGVuY2llcyAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBmdW5jLW5hbWVzICovXHJcbi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC1leHByZXNzaW9ucyAqL1xyXG5cclxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcclxuaW1wb3J0IG9uQ2hhbmdlIGZyb20gJ29uLWNoYW5nZSc7XHJcblxyXG5jb25zdCBnZXRFbGVtZW50c0luID0gKHN0YXRlLCB0eXBlLCBpc0RvbmUgPSBmYWxzZSkgPT4ge1xyXG4gIHN3aXRjaCAodHlwZSkge1xyXG4gICAgY2FzZSAnbGlzdCc6IHtcclxuICAgICAgcmV0dXJuIHN0YXRlLmxpc3RzO1xyXG4gICAgfVxyXG4gICAgY2FzZSAndGFzayc6IHtcclxuICAgICAgcmV0dXJuIF8uY29uY2F0KHN0YXRlLnRhc2tzKVxyXG4gICAgICAgIC5maWx0ZXIoKHRhc2spID0+ICh0YXNrLnBhcmVudExpc3QgPT09IHN0YXRlLmFjdGl2ZUxpc3QubmFtZSAmJiB0YXNrLmlzRG9uZSA9PT0gaXNEb25lKSk7XHJcbiAgICB9XHJcbiAgICBkZWZhdWx0OiB7XHJcbiAgICAgIHRocm93IEVycm9yKGBVbmtub3duIHR5cGUgaW4gZnVuY3Rpb24gLSBcImdldEVsZW1lbnRzSW5cIjogJHt0eXBlfWApO1xyXG4gICAgfVxyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGdldEVsZW1lbnRCeUlkID0gKHN0YXRlLCBpZCwgdHlwZSA9ICd0YXNrJykgPT4gKFxyXG4gIFsuLi5nZXRFbGVtZW50c0luKHN0YXRlLCB0eXBlKSwgLi4uZ2V0RWxlbWVudHNJbihzdGF0ZSwgdHlwZSwgdHJ1ZSldXHJcbiAgICAuZmluZCgodGFzaykgPT4gdGFzay5pZCA9PT0gaWQpXHJcbik7XHJcblxyXG5jb25zdCBzb3J0QnlQb3NpdGlvbiA9IChhcnJheSkgPT4gXy5jb25jYXQoYXJyYXkpLnNvcnQoKGEsIGIpID0+IChhLnBvc2l0aW9uIC0gYi5wb3NpdGlvbikpO1xyXG5cclxuY29uc3Qgc29ydFBvc2l0aW9uc0FmdGVyUmVtb3ZlID0gKHN0YXRlLCB0eXBlLCBpc0RvbmUpID0+IHtcclxuICBjb25zdCBzb3J0R3JvdXAgPSBnZXRFbGVtZW50c0luKHN0YXRlLCB0eXBlLCBpc0RvbmUpO1xyXG4gIHNvcnRCeVBvc2l0aW9uKHNvcnRHcm91cCkucmVkdWNlKChhY2NJbmRleCwgZWwpID0+IHtcclxuICAgIGVsLnBvc2l0aW9uID0gYWNjSW5kZXg7XHJcbiAgICByZXR1cm4gYWNjSW5kZXggKyAxO1xyXG4gIH0sIDApO1xyXG59O1xyXG5cclxuY29uc3QgZ2V0UG9zaXRpb24gPSAoc3RhdGUsIHR5cGUsIGlzRG9uZSA9IGZhbHNlKSA9PiBnZXRFbGVtZW50c0luKHN0YXRlLCB0eXBlLCBpc0RvbmUpLmxlbmd0aDtcclxuXHJcbmNvbnN0IGdldFNlbGVjdGVkRWxlbWVudElkID0gKHN0YXRlKSA9PiB7XHJcbiAgaWYgKHN0YXRlLmFjdGl2ZVRhc2tJZCAhPT0gbnVsbCkgcmV0dXJuIHN0YXRlLmFjdGl2ZVRhc2tJZDtcclxuICBjb25zdCBuZXh0RWxlbWVudCA9IHNvcnRCeVBvc2l0aW9uKGdldEVsZW1lbnRzSW4oc3RhdGUsICd0YXNrJykpWzBdO1xyXG4gIHJldHVybiAobmV4dEVsZW1lbnQgPyBuZXh0RWxlbWVudC5pZCA6IG51bGwpO1xyXG59O1xyXG5cclxuY29uc3QgZXZlbnRGdW5jdGlvbnMgPSB7XHJcbiAgbGlzdHM6IHtcclxuICAgIHNlbGVjdDogKHN0YXRlLCBidXR0b24pID0+IHtcclxuICAgICAgY29uc3QgeyBpZCwgbmFtZSB9ID0gYnV0dG9uLmRhdGFzZXQ7XHJcbiAgICAgIHN0YXRlLmFjdGl2ZUxpc3QgPSB7IGlkLCBuYW1lIH07XHJcbiAgICB9LFxyXG4gIH0sXHJcbiAgYnV0dG9uczoge1xyXG4gICAgcmVwbGFjZTogKHN0YXRlLCBidXR0b24pID0+IHtcclxuICAgICAgY29uc3QgcmVwbGFjZVR5cGUgPSBidXR0b24uZGF0YXNldC5idXR0b25GdW5jO1xyXG4gICAgICBjb25zdCB0YXNrQ29udGFpbmVyID0gYnV0dG9uLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcclxuICAgICAgY29uc3QgeyB0eXBlLCBpZCB9ID0gdGFza0NvbnRhaW5lci5kYXRhc2V0O1xyXG4gICAgICBjb25zdCB1cERvd25Qb3MgPSAocmVwbGFjZVR5cGUgPT09ICd1cCcgPyAtMSA6IDEpO1xyXG4gICAgICBjb25zdCBtYWluRWxlbWVudCA9IGdldEVsZW1lbnRCeUlkKHN0YXRlLCBpZCwgdHlwZSk7XHJcbiAgICAgIGNvbnN0IHNlY29uZGFyeUVsZW1lbnQgPSBnZXRFbGVtZW50c0luKHN0YXRlLCB0eXBlKS5maW5kKCh0YXNrKSA9PiAoXHJcbiAgICAgICAgdGFzay5wb3NpdGlvbiA9PT0gbWFpbkVsZW1lbnQucG9zaXRpb24gKyB1cERvd25Qb3NcclxuICAgICAgKSk7XHJcbiAgICAgIGlmICghc2Vjb25kYXJ5RWxlbWVudCkgcmV0dXJuO1xyXG4gICAgICBtYWluRWxlbWVudC5wb3NpdGlvbiArPSB1cERvd25Qb3M7XHJcbiAgICAgIHNlY29uZGFyeUVsZW1lbnQucG9zaXRpb24gLT0gdXBEb3duUG9zO1xyXG4gICAgfSxcclxuICAgIHN0YXJ0T3V0T2ZUdXJuOiAoc3RhdGUsIGJ1dHRvbikgPT4ge1xyXG4gICAgICBjb25zdCB0YXNrQ29udGFpbmVyID0gYnV0dG9uLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcclxuICAgICAgY29uc3QgeyBpZCB9ID0gdGFza0NvbnRhaW5lci5kYXRhc2V0O1xyXG4gICAgICBzdGF0ZS5hY3RpdmVUYXNrSWQgPSBpZDtcclxuICAgICAgc3RhdGUubWFpblN0YXRlLnNldFZhbHVlcyhpZCk7XHJcbiAgICB9LFxyXG4gICAgZG9uZVVuZG9uZTogKHN0YXRlLCBidXR0b24pID0+IHtcclxuICAgICAgY29uc3QgdGFza0NvbnRhaW5lciA9IGJ1dHRvbi5wYXJlbnROb2RlLnBhcmVudE5vZGU7XHJcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHRhc2tDb250YWluZXIuZGF0YXNldDtcclxuICAgICAgY29uc3QgdGFzayA9IGdldEVsZW1lbnRCeUlkKHN0YXRlLCBpZCk7XHJcbiAgICAgIHRhc2suaXNEb25lID0gIXRhc2suaXNEb25lO1xyXG4gICAgICBpZiAodGFzay5pc0RvbmUgJiYgZ2V0U2VsZWN0ZWRFbGVtZW50SWQoc3RhdGUpID09PSBpZCkge1xyXG4gICAgICAgIHN0YXRlLm1haW5TdGF0ZS5pc0RvbmUgPSAhc3RhdGUubWFpblN0YXRlLmlzRG9uZTtcclxuICAgICAgfVxyXG4gICAgICB0YXNrLnBvc2l0aW9uID0gZ2V0UG9zaXRpb24oc3RhdGUsICd0YXNrJywgdGFzay5pc0RvbmUpO1xyXG4gICAgICBzb3J0UG9zaXRpb25zQWZ0ZXJSZW1vdmUoc3RhdGUsICd0YXNrJywgZmFsc2UpO1xyXG4gICAgICBzb3J0UG9zaXRpb25zQWZ0ZXJSZW1vdmUoc3RhdGUsICd0YXNrJywgdHJ1ZSk7XHJcbiAgICB9LFxyXG4gICAgcmVtb3ZlOiAoc3RhdGUsIGJ1dHRvbikgPT4ge1xyXG4gICAgICBjb25zdCB0YXNrQ29udGFpbmVyID0gYnV0dG9uLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcclxuICAgICAgY29uc3QgeyB0eXBlLCBpZCB9ID0gdGFza0NvbnRhaW5lci5kYXRhc2V0O1xyXG4gICAgICBjb25zdCB0eXBlQXJlYSA9IGAke3R5cGUgPT09ICdsaXN0JyA/ICdsaXN0cycgOiAndGFza3MnfWA7XHJcbiAgICAgIHN0YXRlW3R5cGVBcmVhXSA9IHN0YXRlW3R5cGVBcmVhXS5maWx0ZXIoKGVsKSA9PiBlbC5pZCAhPT0gaWQpO1xyXG4gICAgICBjb25zdCBpc0RvbmUgPSAodHlwZSA9PT0gJ2RvbmVUYXNrJyk7XHJcbiAgICAgIHNvcnRQb3NpdGlvbnNBZnRlclJlbW92ZShzdGF0ZSwgJ3Rhc2snLCBpc0RvbmUpO1xyXG4gICAgfSxcclxuICB9LFxyXG59O1xyXG5cclxuY29uc3Qgc2VsZWN0QnV0dG9ucyA9IHtcclxuICBsaXN0OiAoaXNNdXRhYmxlKSA9PiAoaXNNdXRhYmxlID8gWyd1cCcsICdkb3duJywgJ3JlbW92ZSddIDogWyd1cCcsICdkb3duJ10pLFxyXG4gIHRhc2s6IChpc0FjdGl2ZSkgPT4gKGlzQWN0aXZlID8gWyd1cCcsICdkb3duJywgJ2RvbmUnLCAncmVtb3ZlJ10gOiBbJ3VwJywgJ2Rvd24nLCAnc3RhcnRPdXRPZlR1cm4nLCAnZG9uZScsICdyZW1vdmUnXSksXHJcbiAgZG9uZVRhc2s6ICgpID0+IFsndW5kb25lJywgJ3JlbW92ZSddLFxyXG59O1xyXG5cclxuY29uc3QgcHV0QnV0dG9ucyA9IChzdGF0ZSwgZWxlbWVudFR5cGUsIHsgYnV0dG9ucyB9LCBvcHRpb24gPSBudWxsKSA9PiAoXHJcbiAgYnV0dG9ucy5maWx0ZXIoKHsgdHlwZSB9KSA9PiBzZWxlY3RCdXR0b25zW2VsZW1lbnRUeXBlXShvcHRpb24pLmluY2x1ZGVzKHR5cGUpKVxyXG4gICAgLm1hcCgoeyBidXR0b24gfSkgPT4gYnV0dG9uLmNsb25lTm9kZSh0cnVlKSlcclxuICAgIC5tYXAoKGJ1dHRvbikgPT4ge1xyXG4gICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBldmVudEZ1bmN0aW9ucy5idXR0b25zW2J1dHRvbi5kYXRhc2V0LmJ1dHRvblR5cGVdKHN0YXRlLCBlLnRhcmdldCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gYnV0dG9uO1xyXG4gICAgfSlcclxuKTtcclxuXHJcbmNvbnN0IHJlc2V0SW5wdXRzID0gKGVsZW1lbnRzKSA9PiB7XHJcbiAgZWxlbWVudHMubGlzdEZvcm0ucmVzZXQoKTtcclxuICBlbGVtZW50cy50YXNrRm9ybS5yZXNldCgpO1xyXG59O1xyXG5cclxuY29uc3QgcmVuZGVyTGlzdHMgPSAoc3RhdGUsIGVsZW1lbnRzKSA9PiB7XHJcbiAgY29uc3QgdWxGb3JMaXN0cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XHJcbiAgc29ydEJ5UG9zaXRpb24oZ2V0RWxlbWVudHNJbihzdGF0ZSwgJ2xpc3QnKSlcclxuICAgIC5mb3JFYWNoKCh7IGlkLCBuYW1lLCBpc011dGFibGUgfSkgPT4ge1xyXG4gICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgICAgIGxpLmRhdGFzZXQudHlwZSA9ICdsaXN0JztcclxuICAgICAgbGkuZGF0YXNldC5pZCA9IGlkO1xyXG4gICAgICBsaS5kYXRhc2V0Lm5hbWUgPSBuYW1lO1xyXG4gICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgICB0ZXh0LnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgICAgbGkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoeyB0YXJnZXQsIGN1cnJlbnRUYXJnZXQgfSkgPT4ge1xyXG4gICAgICAgIGlmIChjdXJyZW50VGFyZ2V0ID09PSB0YXJnZXQgfHwgdGV4dCA9PT0gdGFyZ2V0KSBldmVudEZ1bmN0aW9ucy5saXN0cy5zZWxlY3Qoc3RhdGUsIGxpKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGFsbEJ1dHRvbnMgPSBwdXRCdXR0b25zKHN0YXRlLCAnbGlzdCcsIGVsZW1lbnRzLCBpc011dGFibGUpO1xyXG4gICAgICBjb25zdCByZXBsYWNlQnV0dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICByZXBsYWNlQnV0dC5jbGFzc0xpc3QuYWRkKCdyZXBsYWNlQ29udGFpbmVyJyk7XHJcbiAgICAgIHJlcGxhY2VCdXR0LmFwcGVuZCguLi5hbGxCdXR0b25zLmZpbHRlcigoYikgPT4gYi5kYXRhc2V0LmJ1dHRvblR5cGUgPT09ICdyZXBsYWNlJykpO1xyXG4gICAgICBpZiAoaWQgPT09IHN0YXRlLmFjdGl2ZUxpc3QuaWQpIHtcclxuICAgICAgICBsaS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgICAgICBsaS5hcHBlbmQocmVwbGFjZUJ1dHQsIHRleHQpO1xyXG4gICAgICB9IGVsc2UgaWYgKCFpc011dGFibGUpIHtcclxuICAgICAgICBsaS5hcHBlbmQocmVwbGFjZUJ1dHQsIHRleHQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHJlbW92ZUJ1dHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICByZW1vdmVCdXR0LmNsYXNzTGlzdC5hZGQoJ3JlbW92ZUNvbnRhaW5lcicpO1xyXG4gICAgICAgIHJlbW92ZUJ1dHQuYXBwZW5kQ2hpbGQoYWxsQnV0dG9ucy5maW5kKChiKSA9PiBiLmRhdGFzZXQuYnV0dG9uVHlwZSA9PT0gJ3JlbW92ZScpKTtcclxuICAgICAgICBsaS5hcHBlbmQocmVwbGFjZUJ1dHQsIHRleHQsIHJlbW92ZUJ1dHQpO1xyXG4gICAgICB9XHJcbiAgICAgIHVsRm9yTGlzdHMuYXBwZW5kQ2hpbGQobGkpO1xyXG4gICAgfSk7XHJcbiAgZWxlbWVudHMubGlzdHMuaW5uZXJIVE1MID0gJyc7XHJcbiAgZWxlbWVudHMubGlzdHMuYXBwZW5kQ2hpbGQodWxGb3JMaXN0cyk7XHJcblxyXG4gIHJlc2V0SW5wdXRzKGVsZW1lbnRzKTtcclxufTtcclxuY29uc3QgcmVuZGVyVGFza3MgPSAoc3RhdGUsIGVsZW1lbnRzKSA9PiB7XHJcbiAgY29uc3QgdWxGb3JUYXNrcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XHJcbiAgc29ydEJ5UG9zaXRpb24oZ2V0RWxlbWVudHNJbihzdGF0ZSwgJ3Rhc2snLCBmYWxzZSkpLmZvckVhY2goKHsgaWQsIG5hbWUgfSkgPT4ge1xyXG4gICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gICAgbGkuZGF0YXNldC5pZCA9IGlkO1xyXG4gICAgbGkuZGF0YXNldC50eXBlID0gJ3Rhc2snO1xyXG4gICAgY29uc3QgaXNBY3RpdmUgPSAoaWQgPT09IGdldFNlbGVjdGVkRWxlbWVudElkKHN0YXRlKSk7XHJcbiAgICBpZiAoaXNBY3RpdmUpIHtcclxuICAgICAgbGkuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgdGV4dC50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICBjb25zdCBhbGxCdXR0b25zID0gcHV0QnV0dG9ucyhzdGF0ZSwgJ3Rhc2snLCBlbGVtZW50cywgaXNBY3RpdmUpO1xyXG4gICAgY29uc3QgcmVwbGFjZUJ1dHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHJlcGxhY2VCdXR0LmNsYXNzTGlzdC5hZGQoJ3JlcGxhY2VDb250YWluZXInKTtcclxuICAgIHJlcGxhY2VCdXR0LmFwcGVuZCguLi5hbGxCdXR0b25zLmZpbHRlcigoYikgPT4gYi5kYXRhc2V0LmJ1dHRvblR5cGUgPT09ICdyZXBsYWNlJykpO1xyXG4gICAgY29uc3QgcmVtb3ZlQnV0dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgcmVtb3ZlQnV0dC5jbGFzc0xpc3QuYWRkKCdyZW1vdmVDb250YWluZXInKTtcclxuICAgIHJlbW92ZUJ1dHQuYXBwZW5kQ2hpbGQoYWxsQnV0dG9ucy5maW5kKChiKSA9PiBiLmRhdGFzZXQuYnV0dG9uVHlwZSA9PT0gJ3JlbW92ZScpKTtcclxuICAgIGNvbnN0IG90aGVyQnV0dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgb3RoZXJCdXR0LmNsYXNzTGlzdC5hZGQoJ290aGVyQ29udGFpbmVyJyk7XHJcbiAgICBvdGhlckJ1dHQuYXBwZW5kKC4uLmFsbEJ1dHRvbnMuZmlsdGVyKChiKSA9PiAoXHJcbiAgICAgIGIuZGF0YXNldC5idXR0b25UeXBlICE9PSAncmVwbGFjZScgJiYgYi5kYXRhc2V0LmJ1dHRvblR5cGUgIT09ICdyZW1vdmUnXHJcbiAgICApKSk7XHJcbiAgICBsaS5hcHBlbmQocmVwbGFjZUJ1dHQsIHRleHQsIG90aGVyQnV0dCwgcmVtb3ZlQnV0dCk7XHJcbiAgICB1bEZvclRhc2tzLmFwcGVuZENoaWxkKGxpKTtcclxuICB9KTtcclxuICBlbGVtZW50cy50YXNrcy5pbm5lckhUTUwgPSAnJztcclxuICBpZiAodWxGb3JUYXNrcy5pbm5lckhUTUwgIT09ICcnKSB7XHJcbiAgICBlbGVtZW50cy50YXNrcy5hcHBlbmRDaGlsZCh1bEZvclRhc2tzKTtcclxuICB9IGVsc2Uge1xyXG4gICAgZWxlbWVudHMudGFza3MuYXBwZW5kQ2hpbGQoZWxlbWVudHMudGFza1Byb21wdCk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB1bEZvckRvbmVUYXNrcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XHJcbiAgc29ydEJ5UG9zaXRpb24oZ2V0RWxlbWVudHNJbihzdGF0ZSwgJ3Rhc2snLCB0cnVlKSkuZm9yRWFjaCgoeyBpZCwgbmFtZSB9KSA9PiB7XHJcbiAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgICBsaS5kYXRhc2V0LmlkID0gaWQ7XHJcbiAgICBsaS5kYXRhc2V0LnR5cGUgPSAnZG9uZVRhc2snO1xyXG4gICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgIHRleHQudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgY29uc3QgYWxsQnV0dG9ucyA9IHB1dEJ1dHRvbnMoc3RhdGUsICdkb25lVGFzaycsIGVsZW1lbnRzKTtcclxuICAgIGNvbnN0IHJlbW92ZUJ1dHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHJlbW92ZUJ1dHQuY2xhc3NMaXN0LmFkZCgncmVtb3ZlQ29udGFpbmVyJyk7XHJcbiAgICByZW1vdmVCdXR0LmFwcGVuZENoaWxkKGFsbEJ1dHRvbnMuZmluZCgoYikgPT4gYi5kYXRhc2V0LmJ1dHRvblR5cGUgPT09ICdyZW1vdmUnKSk7XHJcbiAgICBjb25zdCB1bmRvbmVCdXR0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICB1bmRvbmVCdXR0LmNsYXNzTGlzdC5hZGQoJ3VuZG9uZUNvbnRhaW5lcicpO1xyXG4gICAgdW5kb25lQnV0dC5hcHBlbmRDaGlsZChhbGxCdXR0b25zLmZpbmQoKGIpID0+IGIuZGF0YXNldC5idXR0b25UeXBlID09PSAnZG9uZVVuZG9uZScpKTtcclxuICAgIGxpLmFwcGVuZCh1bmRvbmVCdXR0LCB0ZXh0LCByZW1vdmVCdXR0KTtcclxuICAgIHVsRm9yRG9uZVRhc2tzLmFwcGVuZENoaWxkKGxpKTtcclxuICB9KTtcclxuICBlbGVtZW50cy5kb25lVGFza3MuaW5uZXJIVE1MID0gJyc7XHJcbiAgaWYgKHVsRm9yRG9uZVRhc2tzLmlubmVySFRNTCAhPT0gJycpIHtcclxuICAgIGVsZW1lbnRzLmRvbmVUYXNrcy5hcHBlbmRDaGlsZCh1bEZvckRvbmVUYXNrcyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGVsZW1lbnRzLmRvbmVUYXNrcy5hcHBlbmRDaGlsZChlbGVtZW50cy5kb25lVGFza1Byb21wdCk7XHJcbiAgfVxyXG5cclxuICByZXNldElucHV0cyhlbGVtZW50cyk7XHJcbn07XHJcblxyXG5jb25zdCByZW5kZXIgPSB7XHJcbiAgbGlzdHM6IHJlbmRlckxpc3RzLFxyXG4gIHRhc2tzOiByZW5kZXJUYXNrcyxcclxuICBhbGw6IChzdGF0ZSwgZWxlbWVudHMpID0+IHtcclxuICAgIHJlbmRlckxpc3RzKHN0YXRlLCBlbGVtZW50cyk7XHJcbiAgICByZW5kZXJUYXNrcyhzdGF0ZSwgZWxlbWVudHMpO1xyXG4gIH0sXHJcbn07XHJcblxyXG5jb25zdCBjcmVhdGVCdXR0b25zTW9kZWxzID0gKCkgPT4ge1xyXG4gIGNvbnN0IHVwQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XHJcbiAgdXBCdXR0b24uY2xhc3NMaXN0LmFkZCgndXAnKTtcclxuICB1cEJ1dHRvbi5kYXRhc2V0LmJ1dHRvblR5cGUgPSAncmVwbGFjZSc7XHJcbiAgdXBCdXR0b24uZGF0YXNldC5idXR0b25GdW5jID0gJ3VwJztcclxuICBjb25zdCBkb3duQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XHJcbiAgZG93bkJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdkb3duJyk7XHJcbiAgZG93bkJ1dHRvbi5kYXRhc2V0LmJ1dHRvblR5cGUgPSAncmVwbGFjZSc7XHJcbiAgZG93bkJ1dHRvbi5kYXRhc2V0LmJ1dHRvbkZ1bmMgPSAnZG93bic7XHJcbiAgY29uc3Qgc3RhcnRPdXRPZlR1cm5CdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcclxuICBzdGFydE91dE9mVHVybkJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdzdGFydE91dE9mVHVybicpO1xyXG4gIHN0YXJ0T3V0T2ZUdXJuQnV0dG9uLmRhdGFzZXQuYnV0dG9uVHlwZSA9ICdzdGFydE91dE9mVHVybic7XHJcbiAgY29uc3QgZG9uZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG4gIGRvbmVCdXR0b24uY2xhc3NMaXN0LmFkZCgnZG9uZScpO1xyXG4gIGRvbmVCdXR0b24uZGF0YXNldC5idXR0b25UeXBlID0gJ2RvbmVVbmRvbmUnO1xyXG4gIGNvbnN0IHVuZG9uZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG4gIHVuZG9uZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCd1bmRvbmUnKTtcclxuICB1bmRvbmVCdXR0b24uZGF0YXNldC5idXR0b25UeXBlID0gJ2RvbmVVbmRvbmUnO1xyXG4gIGNvbnN0IHJlbW92ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG4gIHJlbW92ZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdyZW1vdmUnKTtcclxuICByZW1vdmVCdXR0b24uZGF0YXNldC5idXR0b25UeXBlID0gJ3JlbW92ZSc7XHJcblxyXG4gIHJldHVybiBbXHJcbiAgICB7IHR5cGU6ICd1cCcsIGJ1dHRvbjogdXBCdXR0b24gfSxcclxuICAgIHsgdHlwZTogJ2Rvd24nLCBidXR0b246IGRvd25CdXR0b24gfSxcclxuICAgIHsgdHlwZTogJ3N0YXJ0T3V0T2ZUdXJuJywgYnV0dG9uOiBzdGFydE91dE9mVHVybkJ1dHRvbiB9LFxyXG4gICAgeyB0eXBlOiAnZG9uZScsIGJ1dHRvbjogZG9uZUJ1dHRvbiB9LFxyXG4gICAgeyB0eXBlOiAndW5kb25lJywgYnV0dG9uOiB1bmRvbmVCdXR0b24gfSxcclxuICAgIHsgdHlwZTogJ3JlbW92ZScsIGJ1dHRvbjogcmVtb3ZlQnV0dG9uIH0sXHJcbiAgXTtcclxufTtcclxuXHJcbmNvbnN0IGVsZW1lbnRzID0ge1xyXG4gIGxpc3RzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1jb250YWluZXI9XCJsaXN0c1wiXScpLFxyXG4gIGxpc3RGb3JtOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1jb250YWluZXI9XCJuZXctbGlzdC1mb3JtXCJdJyksXHJcbiAgdGFza3M6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWNvbnRhaW5lcj1cInRhc2tzXCJdJyksXHJcbiAgdGFza1Byb21wdDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtY29udGFpbmVyPVwidGFza3MtcHJvbXB0XCJdJyksXHJcbiAgdGFza0Zvcm06IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWNvbnRhaW5lcj1cIm5ldy10YXNrLWZvcm1cIl0nKSxcclxuICBkb25lVGFza3M6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWNvbnRhaW5lcj1cImRvbmUtdGFza3NcIl0nKSxcclxuICBkb25lVGFza1Byb21wdDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtY29udGFpbmVyPVwiZG9uZS10YXNrcy1wcm9tcHRcIl0nKSxcclxuICBzZWxlY3RlZFRhc2s6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWNvbnRhaW5lcj1cInNlbGVjdGVkLXRhc2tcIl0nKSxcclxuICBidXR0b25zOiBjcmVhdGVCdXR0b25zTW9kZWxzKCksXHJcbn07XHJcblxyXG5jb25zdCBzdGF0ZSA9IG9uQ2hhbmdlKHtcclxuICBhY3RpdmVMaXN0OiB7XHJcbiAgICBpZDogbnVsbCxcclxuICAgIG5hbWU6ICcnLFxyXG4gIH0sXHJcbiAgYWN0aXZlVGFza0lkOiBudWxsLFxyXG4gIGxpc3RzOiBbXSxcclxuICB0YXNrczogW10sXHJcbn0sIGZ1bmN0aW9uIChwYXRoKSB7XHJcbiAgKHBhdGggPT09ICdhY3RpdmVMaXN0JyA/IHJlbmRlci5hbGwodGhpcywgZWxlbWVudHMpIDogbnVsbCk7XHJcbiAgKHBhdGggPT09ICdhY3RpdmVUYXNrSWQnID8gcmVuZGVyLnRhc2tzKHRoaXMsIGVsZW1lbnRzKSA6IG51bGwpO1xyXG4gIChwYXRoLmluY2x1ZGVzKCdsaXN0cycpID8gcmVuZGVyLmxpc3RzKHRoaXMsIGVsZW1lbnRzKSA6IG51bGwpO1xyXG4gIChwYXRoLmluY2x1ZGVzKCd0YXNrcycpID8gcmVuZGVyLnRhc2tzKHRoaXMsIGVsZW1lbnRzKSA6IG51bGwpO1xyXG59KTtcclxuXHJcbmNvbnN0IGluaXQgPSAobWFpblN0YXRlKSA9PiB7XHJcbiAgc3RhdGUubWFpblN0YXRlID0gbWFpblN0YXRlO1xyXG5cclxuICBlbGVtZW50cy5saXN0Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZS50YXJnZXQpO1xyXG4gICAgY29uc3QgdmFsdWUgPSBmb3JtRGF0YS5nZXQoJ25hbWUnKTtcclxuICAgIGlmICh2YWx1ZSAhPT0gJycpIHtcclxuICAgICAgc3RhdGUubGlzdHMucHVzaCh7XHJcbiAgICAgICAgaWQ6IF8udW5pcXVlSWQoKSxcclxuICAgICAgICBuYW1lOiB2YWx1ZSxcclxuICAgICAgICBwb3NpdGlvbjogZ2V0UG9zaXRpb24oc3RhdGUsICdsaXN0JyksXHJcbiAgICAgICAgaXNNdXRhYmxlOiB0cnVlLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgZWxlbWVudHMudGFza0Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGUpID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKGUudGFyZ2V0KTtcclxuICAgIGNvbnN0IHZhbHVlID0gZm9ybURhdGEuZ2V0KCduYW1lJyk7XHJcbiAgICBpZiAodmFsdWUgIT09ICcnKSB7XHJcbiAgICAgIGNvbnN0IHRhc2sgPSB7XHJcbiAgICAgICAgaWQ6IF8udW5pcXVlSWQoKSxcclxuICAgICAgICBwYXJlbnRMaXN0OiBzdGF0ZS5hY3RpdmVMaXN0Lm5hbWUsXHJcbiAgICAgICAgbmFtZTogdmFsdWUsXHJcbiAgICAgICAgcG9zaXRpb246IGdldFBvc2l0aW9uKHN0YXRlLCAndGFzaycpLFxyXG4gICAgICAgIGlzRG9uZTogZmFsc2UsXHJcbiAgICAgIH07XHJcbiAgICAgIHN0YXRlLnRhc2tzLnB1c2godGFzayk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGdlbmVyYWxMaXN0ID0ge1xyXG4gICAgaWQ6IF8udW5pcXVlSWQoKSxcclxuICAgIG5hbWU6ICdHZW5lcmFsJyxcclxuICAgIHBvc2l0aW9uOiBnZXRQb3NpdGlvbihzdGF0ZSwgJ2xpc3QnKSxcclxuICAgIGlzTXV0YWJsZTogZmFsc2UsXHJcbiAgfTtcclxuICBzdGF0ZS5hY3RpdmVMaXN0ID0geyBpZDogZ2VuZXJhbExpc3QuaWQsIG5hbWU6IGdlbmVyYWxMaXN0Lm5hbWUgfTtcclxuICBzdGF0ZS5saXN0cy5wdXNoKGdlbmVyYWxMaXN0KTtcclxufTtcclxuXHJcbmNvbnN0IGNvbXBsZXRlVGFzayA9ICgpID0+IHtcclxuICBjb25zdCBpZCA9IGdldFNlbGVjdGVkRWxlbWVudElkKHN0YXRlKTtcclxuICBpZiAoaWQgPT09IG51bGwpIHJldHVybjtcclxuICBjb25zdCB0YXNrID0gZ2V0RWxlbWVudEJ5SWQoc3RhdGUsIGlkKTtcclxuICB0YXNrLmlzRG9uZSA9IHRydWU7XHJcbiAgc3RhdGUuYWN0aXZlVGFza0lkID0gbnVsbDtcclxufTtcclxuXHJcbmNvbnN0IFRhc2tNYW5hZ2VyID0ge1xyXG4gIGluaXQsXHJcbiAgY29tcGxldGVUYXNrLFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgVGFza01hbmFnZXI7XHJcbiJdfQ==